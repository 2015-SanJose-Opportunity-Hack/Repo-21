<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>A simple map</title>

  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />


</head>
<body>

  <div id='map'></div>
  <script>

  L.mapbox.accessToken = 'pk.eyJ1IjoibXlwYXRobWFwIiwiYSI6ImNpZmJsazE1NTJtbWRyc203azFteDZjM3MifQ.4bHjuFSY_Y-xvCN4V4nZeg';
  var map = L.mapbox.map('map', 'mapbox.streets')
  .setView([37.7577,-122.4376], 13);

  var myLayer = L.mapbox.featureLayer().addTo(map);

  var geojson = [<% @addresses.each do |address| %>
      {
        type: "Feature",
        geometry: {
          type: "Point",
          coordinates: [<%=address.longitude%>, <%=address.latitude%>]
        },
        properties: {
          title: "testing",
          address: "<%=address.address%>",
          'marker-size': 'large',
          'marker-color': '#BE9A6B',
          'marker-symbol': 'star'
        }
      }<% if address != @addresses[-1] %>,<% end %>
   <% end %>]

console.log(geojson)

myLayer.setGeoJSON(geojson);



</script>
</body>
</html>